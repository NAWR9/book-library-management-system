<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile | University Library</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <!-- Load Navbar -->
    <div id="navbar-container"></div>

    <!-- Profile Content -->
    <main class="container py-5">
      <div class="row">
        <div class="col-12">
          <h1 class="mb-4" data-i18n="profile">Profile</h1>
          <div class="card">
            <div class="card-body">
              <form id="profileForm">
                <div class="mb-3">
                  <label for="name" class="form-label" data-i18n="fullNameLabel"
                    >Full Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label" data-i18n="emailLabel"
                    >Email</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    disabled
                  />
                </div>
                <div class="mb-3">
                  <label
                    for="password"
                    class="form-label"
                    data-i18n="newPassword"
                    >New Password</label
                  >
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    minlength="6"
                  />
                </div>
                <div class="mb-3">
                  <label
                    for="phoneNumber"
                    class="form-label"
                    data-i18n="phoneNumberLabel"
                    >Phone Number</label
                  >
                  <input
                    type="tel"
                    class="form-control"
                    id="phoneNumber"
                    name="phoneNumber"
                  />
                </div>
                <div class="mb-3">
                  <label
                    for="department"
                    class="form-label"
                    data-i18n="departmentLabel"
                    >Department</label
                  >
                  <select class="form-select" id="department" name="department">
                    <option
                      value=""
                      selected
                      disabled
                      data-i18n="selectDepartment"
                    >
                      Select your department
                    </option>
                    <option
                      value="Engineering"
                      data-i18n="departments.engineering"
                    >
                      Engineering
                    </option>
                    <option
                      value="Computer Science"
                      data-i18n="departments.computerScience"
                    >
                      Computer Science
                    </option>
                    <option value="Business" data-i18n="departments.business">
                      Business
                    </option>
                    <option value="Medicine" data-i18n="departments.medicine">
                      Medicine
                    </option>
                    <option value="Law" data-i18n="departments.law">Law</option>
                    <option value="Arts" data-i18n="departments.arts">
                      Arts
                    </option>
                    <option value="Education" data-i18n="departments.education">
                      Education
                    </option>
                    <option value="Science" data-i18n="departments.science">
                      Science
                    </option>
                  </select>
                </div>
                <div class="d-grid">
                  <button
                    type="submit"
                    class="btn btn-primary btn-lg"
                    data-i18n="updateAccount"
                  >
                    Update Profile
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
      <div class="container">
        <p class="mb-0" data-i18n="copyright">
          &copy; 2025 University Library. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="./js/auth.js"></script>

    <script type="module">
      import i18n from "./js/i18n.js";

      document.addEventListener("DOMContentLoaded", async function () {
        // Load the navbar
        fetch("./components/navbar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("navbar-container").innerHTML = data;

            const auth = new Auth();

            // Redirect to login if not logged in
            if (!auth.isLoggedIn()) {
              window.location.href = "./login.html";
            } else {
              // Populate profile form with user data
              const user = auth.getUser();
              console.log(auth.getUser());
              document.getElementById("name").value = user.name;
              document.getElementById("email").value = user.email;
              document.getElementById("phoneNumber").value =
                user.phoneNumber || "";
              document.getElementById("department").value =
                user.department || "";

              // Handle profile form submission
              document
                .getElementById("profileForm")
                .addEventListener("submit", async function (e) {
                  e.preventDefault();

                  // Validate form inputs
                  const name = document.getElementById("name").value.trim();
                  const password = document
                    .getElementById("password")
                    .value.trim();
                  const phoneNumber = document
                    .getElementById("phoneNumber")
                    .value.trim();
                  const department =
                    document.getElementById("department").value;

                  // Validation checks
                  if (!name) {
                    alert("Full name is required.");
                    return;
                  }

                  if (password && password.length < 6) {
                    alert("Password must be at least 6 characters.");
                    return;
                  }

                  // Update profile
                  await auth.updateProfile({
                    name,
                    password,
                    phoneNumber,
                    department,
                  });
                });
            }
          });

        // Initialize translations
        await i18n.init();
      });
    </script>
  </body>
</html>
